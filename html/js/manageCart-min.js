function refreshCart(){totalPrice=0;storage=(storage=window.localStorage.getItem("cart_storage"))?JSON.parse(storage):{};document.querySelector(".shopping-cart").innerHTML="";for(var b in storage)myLib.ajax({url:"process.php?id="+encodeURIComponent(b.toString()),success:function(a){product=JSON.parse(a);void 0==product.failed&&(a=[],a.push('<li><input id="q_'),a.push(product.pid.toString().escapeHTML()),a.push('" class="quantity" type="number" name="num" value="'),a.push(storage[product.pid].toString().escapeHTML()),
a.push('" onchange="changeQuantity('),a.push(product.pid.toString().escapeHTML()),a.push(')"/> '),a.push(product.name.toString().escapeHTML()),a.push(" @ $"),a.push(product.price.toString().escapeHTML()),a.push("</li>"),document.querySelector(".shopping-cart").innerHTML+=a.join(""),totalPrice+=product.price*storage[product.pid],document.querySelector("#price").innerHTML="<p>Total Price = $"+totalPrice.toString().escapeHTML()+"</p>")}});document.querySelector("#price").innerHTML="<p>Total Price = $"+
totalPrice.toString().escapeHTML()+"</p>"}function addtocart(b){var a=localStorage.getItem("cart_storage");a=void 0==a?{}:JSON.parse(a);void 0==a[b]&&(a[b]=0);a[b]=parseInt(a[b])+1;localStorage.setItem("cart_storage",JSON.stringify(a));refreshCart();alert("Product added to cart!")}
function changeQuantity(b){var a=localStorage.getItem("cart_storage");if(void 0!=a){a=JSON.parse(a);var c=document.querySelector("#q_"+b).value;""==c||0>=parseInt(c)?delete a[b]:a[b]=parseInt(c);localStorage.setItem("cart_storage",JSON.stringify(a));refreshCart()}}
function cartSubmit(){var b=window.localStorage.getItem("cart_storage");if(void 0==b)return!1;b=JSON.parse(b);var a=document.querySelector("#cart"),c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST","checkout-process.php",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=JSON.parse(c.responseText);a.custom.value=e.custom;a.invoice.value=e.invoice;for(var d=
0;d<e.items.length;d++){var f=document.createElement("input");f.type="hidden";f.name="item_name_"+(d+1);f.value=e.items[d][0].toString();var g=document.createElement("input");g.type="hidden";g.name="amount_"+(d+1);g.value=e.items[d][1].toString();var h=document.createElement("input");h.type="hidden";h.name="quantity_"+(d+1);h.value=e.items[d][2].toString();a.appendChild(f);a.appendChild(g);a.appendChild(h)}a.submit()}};c.send("cart="+JSON.stringify(b));for(var k in localStorage)localStorage.removeItem(k)}
